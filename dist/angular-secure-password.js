angular.module("angular-secure-password",[]).directive("securePassword",["$timeout","$sce",function(e,n){return{restrict:"E",replace:!1,transclude:!1,scope:{buffer:"=array",enter:"&",change:"&"},template:'<div style="margin-bottom: 10px;"><span class="secure-input" ng-keypress="append($event)" ng-keydown="alter($event)" tabindex="0"><span ng-repeat="char in notPassword"><span ng-if="$first" class="first-symbol">&nbsp;</span><span class="password-symbol" ng-bind-html="filler">&nbsp;</span></span><span class="blinking-cursor">|&nbsp;</span><span class="placeholder" ng-if="notPassword.length===0">{{placeholder}}</span></span></div>',link:{pre:function(a,s,r){function o(){return console.log("cleared!"),l=0,0!==p&&a.buffer.fill(0),a.notPassword=[],!1}function t(){0!==f&&("boolean"==typeof u?u=e(o,f):(u=e.cancel(u),t()))}function c(e){for(var n=e.clipboardData.getData("Text"),s=0;s<n.length;s++)a.appendChar(n.charCodeAt(s));console.log("Paste: ",n),a.$apply()}var l=0,p=ArrayBuffer.isView(a.buffer)?a.buffer.length:0;a.notPassword=[],a.placeholder=r.placeholder||"Password";var f=("string"==typeof r.extended||!1,parseInt(r.idlemsec,10)||1e3*parseInt(r.idlesec,10)||0),u=!1;a.filler=n.trustAsHtml("&"+(r.filler||"bull")+";"),s[0].onpaste=c,a.alter=function(n){8===n.keyCode&&l>0&&(a.buffer[--l]=0,a.notPassword.splice(-1,1)),8===n.keyCode&&l>=0&&i(n),13===n.keyCode&&"function"==typeof a.enter?(a.enter(),u&&(u=e.cancel(u)),i()):t(),"function"==typeof a.change&&a.change()},a.appendChar=function(e){console.log(e);var n=e>=32&&e<=126,s=e>=32&&e<=255&&129!==e&&141!==e&&143!==e&&144!==e&&157!==e;return!!(l>=0&&l<p&&(n||a.extended===!0&&s))&&(a.buffer[l]=e,a.notPassword.push(l),l++,!0)},a.append=function(e){a.appendChar(e.charCode)&&i(e)},a.$watch("buffer[0]",function(n){0===n&&(a.notPassword=[],l=0,u&&(u=e.cancel(u)))});var i=function(e){e&&(e.preventDefault(),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0)}},post:function(e,n,a){"string"==typeof a.autofocus&&document.querySelector("secure-password[autofocus] > div > span").focus()}}}}]);
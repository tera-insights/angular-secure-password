angular.module("angular-secure-password",[]).directive("securePassword",["$timeout","$sce",function(e,n){return{restrict:"E",replace:!1,transclude:!1,scope:{buffer:"=array",enter:"&",change:"&"},template:'<div style="margin-bottom: 10px;"><span class="secure-input" ng-keypress="append($event)" ng-keydown="alter($event)" tabindex="0"><span ng-repeat="char in notPassword"><span ng-if="$first" class="first-symbol">&nbsp;</span><span class="password-symbol" ng-bind-html="filler">&nbsp;</span></span><span class="blinking-cursor">|&nbsp;</span><span class="placeholder" ng-if="notPassword.length===0">{{placeholder}}</span></span></div>',link:{pre:function(a,r,s){function t(){return c=0,0!==l&&a.buffer.fill(0),a.notPassword=[],!1}function o(){0!==f&&("boolean"==typeof u?u=e(t,f):(u=e.cancel(u),o()))}function p(e){for(var n=e.clipboardData.getData("Text"),r=0;r<n.length;r++)a.appendChar(n.charCodeAt(r));a.$apply()}var c=0,l=ArrayBuffer.isView(a.buffer)?a.buffer.length:0;a.notPassword=[],a.placeholder=s.placeholder||"Password";var f=("string"==typeof s.extended||!1,parseInt(s.idlemsec,10)||1e3*parseInt(s.idlesec,10)||0),u=!1;a.filler=n.trustAsHtml("&"+(s.filler||"bull")+";"),r[0].onpaste=p,a.alter=function(n){8===n.keyCode&&c>0&&(a.buffer[--c]=0,a.notPassword.splice(-1,1)),8===n.keyCode&&c>=0&&i(n),13===n.keyCode&&"function"==typeof a.enter?(a.enter(),u&&(u=e.cancel(u)),i()):o(),"function"==typeof a.change&&a.change()},a.appendChar=function(e){var n=e>=32&&e<=126,r=e>=32&&e<=255&&129!==e&&141!==e&&143!==e&&144!==e&&157!==e;return!!(c>=0&&c<l&&(n||a.extended===!0&&r))&&(a.buffer[c]=e,a.notPassword.push(c),c++,!0)},a.append=function(e){a.appendChar(e.charCode)&&i(e)},a.$watch("buffer[0]",function(n){0===n&&(a.notPassword=[],c=0,u&&(u=e.cancel(u)))});var i=function(e){e&&(e.preventDefault(),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0)}},post:function(e,n,a){"string"==typeof a.autofocus&&document.querySelector("secure-password[autofocus] > div > span").focus()}}}}]);
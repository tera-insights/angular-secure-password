angular.module("angular-secure-password",[]).directive("securePassword",["$timeout","$sce",function(e,n){return{restrict:"E",replace:!1,transclude:!1,scope:{buffer:"=array",enter:"&"},template:'<div style="margin-bottom: 10px;"><span class="secure-input" ng-keypress="append($event)" ng-keydown="alter($event)" tabindex="0"><span ng-repeat="char in notPassword"><span ng-if="$first" class="first-symbol">&nbsp;</span><span class="password-symbol" ng-bind-html="filler">&nbsp;</span></span><span class="blinking-cursor">|&nbsp;</span><span class="placeholder" ng-if="notPassword.length===0">{{placeholder}}</span></span></div>',link:{pre:function(s,r,a){function t(){return console.log("cleared!"),l=0,0!==c&&s.buffer.fill(0),s.notPassword=[],!1}function o(){0!==p&&("boolean"==typeof u?u=e(t,p):(u=e.cancel(u),o()))}var l=0,c=ArrayBuffer.isView(s.buffer)?s.buffer.length:0;s.notPassword=[],s.placeholder=a.placeholder||"Password";var p=("string"==typeof a.extended||!1,parseInt(a.idlemsec,10)||1e3*parseInt(a.idlesec,10)||0),u=!1;s.filler=n.trustAsHtml("&"+(a.filler||"bull")+";"),s.alter=function(n){8===n.keyCode&&l>0&&(s.buffer[--l]=0,s.notPassword.splice(-1,1)),8===n.keyCode&&l>=0&&f(n),13===n.keyCode&&"function"==typeof s.enter?(s.enter(),u&&(u=e.cancel(u)),f()):o()},s.append=function(e){var n=e.charCode,r=n>=32&&126>=n,a=n>=32&&255>=n&&129!==n&&141!==n&&143!==n&&144!==n&&157!==n;l>=0&&c>l&&(r||s.extended===!0&&a)&&(s.buffer[l]=n,s.notPassword.push(l),l++,f(e))},s.$watch("buffer[0]",function(n){0===n&&(s.notPassword=[],l=0,u&&(u=e.cancel(u)))});var f=function(e){e&&(e.preventDefault(),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0)}},post:function(e,n,s){"string"==typeof s.autofocus&&document.querySelector("secure-password[autofocus] > div > span").focus()}}}}]);
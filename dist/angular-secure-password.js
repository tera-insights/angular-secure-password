angular.module("angular-secure-password",[]).directive("securePassword",["$timeout","$sce",function(e,n){return{restrict:"E",replace:!1,transclude:!1,scope:{buffer:"=array",enter:"&",change:"&"},template:'<div style="margin-bottom: 10px;"><span class="secure-input" ng-keypress="append($event)" ng-keydown="alter($event)" tabindex="0"><span ng-repeat="char in notPassword"><span ng-if="$first" class="first-symbol">&nbsp;</span><span class="password-symbol" ng-bind-html="filler">&nbsp;</span></span><span class="blinking-cursor">|&nbsp;</span><span class="placeholder" ng-if="notPassword.length===0">{{placeholder}}</span></span></div>',link:{pre:function(s,a,r){function t(){return console.log("cleared!"),c=0,0!==l&&s.buffer.fill(0),s.notPassword=[],!1}function o(){0!==p&&("boolean"==typeof f?f=e(t,p):(f=e.cancel(f),o()))}var c=0,l=ArrayBuffer.isView(s.buffer)?s.buffer.length:0;s.notPassword=[],s.placeholder=r.placeholder||"Password";var p=("string"==typeof r.extended||!1,parseInt(r.idlemsec,10)||1e3*parseInt(r.idlesec,10)||0),f=!1;s.filler=n.trustAsHtml("&"+(r.filler||"bull")+";"),s.alter=function(n){8===n.keyCode&&c>0&&(s.buffer[--c]=0,s.notPassword.splice(-1,1)),8===n.keyCode&&c>=0&&u(n),13===n.keyCode&&"function"==typeof s.enter?(s.enter(),f&&(f=e.cancel(f)),u()):o(),"function"==typeof s.change&&s.change()},s.append=function(e){var n=e.charCode,a=n>=32&&n<=126,r=n>=32&&n<=255&&129!==n&&141!==n&&143!==n&&144!==n&&157!==n;c>=0&&c<l&&(a||s.extended===!0&&r)&&(s.buffer[c]=n,s.notPassword.push(c),c++,u(e))},s.$watch("buffer[0]",function(n){0===n&&(s.notPassword=[],c=0,f&&(f=e.cancel(f)))});var u=function(e){e&&(e.preventDefault(),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0)}},post:function(e,n,s){"string"==typeof s.autofocus&&document.querySelector("secure-password[autofocus] > div > span").focus()}}}}]);